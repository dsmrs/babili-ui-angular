!function(){"use strict";var a=angular.module("babili-ui",[]);a.config(["$stateProvider","$locationProvider",function(a,b){b.html5Mode(!0),a.state("bu",{parent:"bw.babili-ui","abstract":!0,template:"<ui-view />"}).state("bu.show",{url:"/:id",controller:"BabiliUiController",templateUrl:"src/babili_ui.html",resolve:{users:["UserResource",function(a){return a.query().$promise}],user:["UserResource","$stateParams",function(a,b){return a.get({id:b.id}).$promise}],babiliUser:["$rootScope","user","users","babili",function(a,b,c,d){return d.connect(a,b.babiliToken)}]},onExit:["babili",function(a){a.disconnect()}]})}])}(),function(){"use strict";angular.module("babili-ui").controller("BabiliUiController",["$scope","$rootScope","$state","$modal","babiliUser","user","users","UserResource",function(a,b,c,d,e,f,g,h){a.babiliUser=e,a.user=f,a.users=g,a.newMessage={},a.createRoom=function(){d.open({backdrop:"static",templateUrl:"src/components/rooms/new/new.html",controller:"BabiliUiRoomsNewController",resolve:{babiliUser:function(){return e},users:function(){return h.query().$promise},user:function(){return a.user}}})},a.editRoom=function(a){return d.open({backdrop:"static",templateUrl:"src/components/rooms/edit/edit.html",controller:"BabiliUiRoomsEditController",resolve:{babiliUser:function(){return e},room:function(){return angular.copy(a)}}})},a.addUserToRoom=function(b){return d.open({backdrop:"static",templateUrl:"src/components/memberships/new/new.html",controller:"BabiliUiMembershipsNewController",resolve:{babiliUser:function(){return e},room:function(){return angular.copy(b)},users:function(){return h.query().$promise},user:function(){return a.user}}})},a.roomName=function(a){return a&&null!==a.name?a.name:"Unnamed room"},a.closeRoom=function(b){e.closeRoom(b).then(function(){a.$apply(function(){a.openedRoom=null})})},a.openRoom=function(b){e.openRoomAndCloseOthers(b).then(function(b){b&&a.$apply(function(){a.openedRoom=b,setTimeout(function(){$(".room-messages").scrollTop($(".room-messages")[0].scrollHeight)},4)})})},a.getUserFromBabiliId=function(b){return _.find(a.users,function(a){return a.babiliId===b})},a.sendMessage=function(b){e.sendMessage(b,{content:a.newMessage.content,contentType:"text"}).then(function(){a.newMessage.content=null,a.$apply(function(){})})}}])}(),function(){"use strict";angular.module("babili-ui").controller("BabiliUiMembershipsNewController",["$scope","$modalInstance","babiliUser","room","user","users",function(a,b,c,d,e,f){a.users=f,a.selectedUsers=d.users,a.selectedUser=null,a.newSelectedUsers=[],a.room=d,a.user=e,a.submit=function(){var e;e=_.map(a.newSelectedUsers,function(a){return a.babiliId}),e.length>0?c.addUserToRoom(d,e[0]).then(function(){b.close()}):b.close()},a.userSelected=function(b,c){a.selectedUsers.push(c),a.newSelectedUsers.push(c),a.selectedUser=null},a.removeSelectedUser=function(b){var c;c=a.newSelectedUsers.indexOf(b),c>-1&&a.newSelectedUsers.splice(c,1)},a.cancel=function(a){b.dismiss(),a.preventDefault()}}])}(),function(){"use strict";angular.module("babili-ui").controller("BabiliUiRoomsEditController",["$scope","$modalInstance","room","babiliUser",function(a,b,c,d){a.room=c,a.submit=function(){d.updateRoomName(a.room).then(function(){b.close(c)})},a.cancel=function(a){b.dismiss(),a.preventDefault()}}])}(),function(){"use strict";angular.module("babili-ui").controller("BabiliUiRoomsNewController",["$scope","$modalInstance","babiliUser","users","user",function(a,b,c,d,e){a.users=d,a.user=e,a.selectedUsers=[],a.selectedUser=null,a.room={name:""},a.submit=function(){var d;d=_.map(a.selectedUsers,function(a){return a.babiliId}),d.length>0?c.createRoom(a.room.name,d).then(function(){b.close()}):b.close()},a.userSelected=function(b,c){a.selectedUsers.push(c),a.selectedUser=null},a.removeSelectedUser=function(b){var c;c=a.selectedUsers.indexOf(b),c>-1&&a.selectedUsers.splice(c,1)},a.cancel=function(a){b.dismiss(),a.preventDefault()}}])}(),angular.module("babili-ui").run(["$templateCache",function(a){"use strict";a.put("src/babili_ui.html",'<div class="row babili-ui full-height">\n  <div class="col-md-3 rooms">\n    <h2>\n      Rooms\n      <small>\n        <a href="#" ng-click="createRoom()" class="pull-right fa-big-link"><i class="fa fa-plus-square-o"></i></a>\n      </small>\n    </h2>\n    <div class="room-list-placeholder" ng-hide="babiliUser.rooms.length > 0">\n      No rooms yet, you can create one by clicking on <i class="fa fa-plus-square-o"></i>\n    </div>\n    <ul class="room-list">\n      <li ng-repeat="room in babiliUser.rooms" ng-click="openRoom(room)" ng-class="{active: openedRoom.id == room.id}" class="room-list-item">\n        {{roomName(room)}}\n        <table class="room-user-list">\n          <tbody>\n            <tr ng-repeat="roomUser in room.users" class="room-user-list-item">\n              <td class="room-user-name">\n                {{getUserFromBabiliId(roomUser.id).name}}\n              </td>\n              <td class="room-user-status">\n                <span ng-show="roomUser.status == \'online\'">\n                  <i class="fa fa-circle"></i>\n                </span>\n                <span ng-hide="roomUser.status == \'online\'">\n                  <i class="fa fa-circle-o"></i>\n                </span>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </li>\n    </ul>\n  </div>\n\n  <div class="col-md-9 no-room-selected-placeholder" ng-hide="openedRoom">\n    <p>\n      Hi {{user.name}},\n      <br/>\n      you need to select a room.\n    </p>\n  </div>\n\n  <div class="col-md-9 room" ng-show="openedRoom">\n    <h2>\n      {{roomName(openedRoom)}}\n      <a href="#" ng-click="editRoom(openedRoom)" class="fa-big-link">\n        <i class="fa fa-pencil-square-o"></i>\n      </a>\n      <small class="pull-right">\n        <a href="#" ng-click="addUserToRoom(openedRoom)" class="fa-big-link">\n          <i class="fa fa-user"></i>\n        </a>\n\n        <a href="#" ng-click="closeRoom(openedRoom)" class="fa-big-link">\n          <i class="fa fa-times-circle"></i>\n        </a>\n      </small>\n    </h2>\n    <div class="room-messages" scroll-bottom="openedRoom.messages">\n      <ul>\n        <li ng-repeat="message in openedRoom.messages track by message.id" ng-class="babiliUser.messageSentByMe(message)? \'message-sent\':\'message-received\'">\n          <div>{{message.content}}</div>\n          <div class="message-information" ng-hide="isMessageSentByMe(message)">\n            Sent by {{message.senderId}} at {{message.createdAt}}\n          </div>\n\n          <div class="message-information" ng-show="isMessageSentByMe(message)">\n            Sent by you at {{message.createdAt}}\n          </div>\n        </li>\n      </ul>\n    </div>\n    <div class="room-new-message">\n      <div class="row full-height">\n        <form name="form" ng-submit="sendMessage(openedRoom)">\n          <div class="col-md-10 full-height">\n            <textarea class="form-control" id="message" ng-model="newMessage.content" placeholder="Type your message" required></textarea>\n          </div>\n          <div class="col-md-2 full-height">\n            <button type="submit" class="btn btn-primary">Send</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n</div>\n'),a.put("src/components/memberships/new/new.html",'<div class="babili-ui">\n  <div class="modal-header">\n    <h3 class="modal-title">Add user to room</h3>\n  </div>\n  <form name="form" ng-submit="submit()">\n    <div class="modal-body">\n      <div class="form-group">\n        <label for="user">Select new members</label>\n        <input type="text" class="form-control form-control-inverted" ng-model="selectedUser" typeahead="user as user.name for user in users | selectableUsers:$viewValue:selectedUsers:user" typeahead-on-select="userSelected($item, $model, $label)" typeahead-editable="false">\n      </div>\n      <div class="form-group" ng-show="newSelectedUsers.length > 0">\n        <label for="users">New members:</label>\n        <ul class="selected-users">\n          <li ng-repeat="newSelectedUser in newSelectedUsers track by newSelectedUser.id" class="selected-user">\n            {{newSelectedUser.name}}\n            <span class="pull-right">\n              <a href="#" ng-click="removeSelectedUser(newSelectedUser)"><i class="fa fa-times"></i></a>\n            </span>\n          </li>\n        </ul>\n      </div>\n    <div>\n    <div class="modal-footer">\n      <button class="btn btn-primary" ng-click="cancel($event)">Cancel</button>\n      <input type="submit" class="btn btn-primary" value="Save">\n    </div>\n  </form>\n</div>\n'),a.put("src/components/rooms/edit/edit.html",'<div class="babili-ui">\n  <div class="modal-header">\n    <h3 class="modal-title">Edit room</h3>\n  </div>\n  <form name="form" ng-submit="submit()">\n    <div class="modal-body">\n      <div class="form-group">\n        <label for="name">Name</label>\n        <input type="text" class="form-control form-control-inverted" ng-model="room.name" placeholder="Enter a room name" required>\n      </div>\n    <div>\n    <div class="modal-footer">\n      <button class="btn btn-primary" ng-click="cancel($event)">Cancel</button>\n      <input type="submit" class="btn btn-primary" value="Save">\n    </div>\n  </form>\n</div>\n'),a.put("src/components/rooms/new/new.html",'<div class="babili-ui">\n  <div class="modal-header">\n    <h3 class="modal-title">Create room</h3>\n  </div>\n  <form name="form" ng-submit="submit()">\n    <div class="modal-body">\n      <div class="form-group">\n        <label for="name">Name</label>\n        <input type="text" class="form-control form-control-inverted" ng-model="room.name" required>\n      </div>\n      <div class="form-group">\n        <label for="user">Select members</label>\n        <input type="text" class="form-control form-control-inverted" ng-model="selectedUser" typeahead="user as user.name for user in users | selectableUsers:$viewValue:selectedUsers:user" typeahead-on-select="userSelected($item, $model, $label)" typeahead-editable="false">\n      </div>\n      <div class="form-group" ng-show="selectedUsers.length > 0">\n        <label for="users">Members:</label>\n        <ul class="selected-users">\n          <li ng-repeat="selectedUser in selectedUsers track by selectedUser.id" class="selected-user">\n            {{selectedUser.name}}\n            <span class="pull-right">\n              <a href="#" ng-click="removeSelectedUser(selectedUser)"><i class="fa fa-times"></i></a>\n            </span>\n          </li>\n        </ul>\n      </div>\n    <div>\n    <div class="modal-footer">\n      <button class="btn btn-primary" ng-click="cancel($event)">Cancel</button>\n      <input type="submit" class="btn btn-primary" value="Save">\n    </div>\n  </form>\n</div>\n')}]);